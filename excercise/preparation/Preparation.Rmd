---
title: "Preparation"
author: "Matthias Sand, Jan-Philipp Kolb and Stefan Zins"
date: "11 Januar 2016"
output: pdf_document
---


```{r, echo=FALSE}
library(knitr)
CA<-T
Ex<-T
```



## Why use R?

- Rapid implementation of new (scientific) developments

- Quick development of new tools that fit the user's demand

- Over 5,000 packages contributed by users available on CRAN

- [Open Source](https://en.wikipedia.org/wiki/Open-source_software) - You can create your own objects, functions and packages

- [Reproducibility](http://www.r-bloggers.com/rs-role-in-science-breakthrough-reproducibility-of-psychology-studies/)

More arguments for the usage of R can be found [here](http://www.nytimes.com/2009/01/07/technology/business-computing/07program.html?_r=2&) or [here](http://www.revolutionanalytics.com/what-r).


## Get R

R can be downloaded here:

www.r-project.org

It can be installed on Windows and Linux plattforms as well as on Macs. 

## R Basic

![Ralt](https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/figure/Ralt.png)

Most R-users prefer the graphical user interface ([GUI](http://www.statmethods.net/interface/guis.html))


## Rstudio

In this course we will use the rstudio gui which can be downloaded here:

www.rstudio.com

## First operations

```{r}
# Comments 
```

[Creating new variables](http://www.statmethods.net/management/variables.html) with the assignment operator `<-`:

```{r}
x<-rnorm(10,0,1)
```

- creates a vector with ten standard-normal-distributed values
- more information can be found [here](https://cran.r-project.org/doc/manuals/r-release/R-intro.html#Vectors-and-assignment)

```{r}
mean(x)
```

calculates the mean of variable x


More basic commands:

```{r}
length(x)
max(x)
min(x)
sd(x)
var(x)
median(x)
```

## Getting help

- [Introduction to R](http://mirrors.softliste.de/cran/)
- [stackoverflow](http://stackoverflow.com/questions/tagged/r)
- [Thomas Girke - Programming in R](http://manuals.bioinformatics.ucr.edu/home/programming-in-r)

If you have problems to find the commands use a [reference card](https://cran.r-project.org/doc/contrib/Short-refcard.pdf)

Get the help page for a command:

```{r,eval=F}
help.start()

help(mean)

  # if you know already the function name:
?mean
```

Often you can get examples like the following one for linear regression.
  
```{r,eval=F}
example(lm)
```


## Draw random numbers:

```{r}
  # Uniform Distribution
x1 <- runif(1000)
  # Normal distribution
x2 <- rnorm(1000)
  # Exponential distribution
x3 <- rexp(1000)

rnorm(20,mean=0,sd=1)
```


## Installing and Loading Packages

Many functions are already implemented in basic R. For more specific tasks libraries have to be installed. This can be done using the command `install.packages`. After the installation the package must be loaded with the command `library`.

```{r,eval=F}
install.packages("sampling")
library("sampling")
```

Here is a list of packages which are relevant for the workshop:

- [foreign](https://cran.r-project.org/web/packages/foreign/index.html) - Read Data Stored by Minitab, S, SAS, SPSS, Stata, Systat, Weka, dBase, ...

- [sampling](https://cran.r-project.org/web/packages/sampling/index.html) - Survey Sampling

- [survey](https://cran.r-project.org/web/packages/survey/index.html) - analysis of complex survey samples

```{r,eval=F}
install.packages("lattice")
install.packages("survey")
```

A list on the most popular R-packages can be found [here](http://blog.revolutionanalytics.com/2013/06/a-list-of-r-packages-by-popularity.html).

## Indexing

```{r}

# vector
A1 <- c(1,2,3,4)
A1
A1[1]
A1[4]
A1[1:3]
A1[-4]
```

```{r}
# dataframe

AA <- 4:1
A2 <- cbind(A1,AA)
A2[1,1]
A2[2,]
A2[,1]
A2[,1:2]
```

```{r}
# array

A3 <- array(1:8,c(2,2,2))
A3
A3[,,2]
```


```{r}
# list

A4 <- list(A1,1)
A4
A4[[2]]
```

## Sequences

```{r}
# sequence from 1 to 10
1:10

seq(-2,8,by=1.5)

a<-seq(3,12,length=12)

b<- seq(to=5,length=12,by=0.2)

d <-1:10
d<- seq(1,10,1)
d <- seq(length=10,from=1,by=1)

# replicate 1 10 times
rep(1,10)
rep("A",10)
```



## Basic Graphics

The plot function is the easiest option to get a graphic:

```{r}
x <- rnorm(1000,0,1)
plot(x)
```

Adding a header:

```{r}
plot(x,main="header")
```



## Histogram

```{r}
hist(x)
```

## The sample function

Usage of the command [sample](https://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html)

![pic](https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/figure/SampleWhat.PNG)

![pic](https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/figure/SampleHow.PNG)

![pic](https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/figure/SampleReplacement.PNG)

```{r}
sample(x=1:10,1)
sample(x=1:10,1,replace=T)
```


## Working Directory and Workspace

Declaring a working directory

```{r,eval=F}
path<-"C:/"

setwd(path)

getwd()

dir()
```


- It is always useful to define and set your working directory at the beginning of each script
- `getwd()` displays you your current working directory
- `dir()` shows you all objects in a specific directory
- `ls()` lists all objects in your workspace
- `rm()` removes a object from your workspace


```{r,eval=F}
rm(list = ls())
```

## [Data Import and Export in R](http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/index.cfm)

Some datasets are implemented in R-packages:

```{r,message=F,warning=F}
library("sampling")
data(belgianmunicipalities)
```

```{r}
head(belgianmunicipalities)
```

Also foreign datasets can be imported:

```{r}
link <- "https://raw.githubusercontent.com/BernStZi/
SamplingAndEsimation/master/excercise/data/my.pop.csv"

my.pop <- read.csv(link)
head(my.pop)
```

In the following the European Social Survey (ESS) data will be used. The data can be downloaded [here](http://www.europeansocialsurvey.org/data/round-index.html).


```{r,echo=F}
data.path <- "D:/Daten/Daten/DatenSonst/"
setwd(data.path)
```

We can import spss data using the command `read.spss` from R-package `foreign`.

```{r,eval=F}
library(foreign)
ESS7 <- read.spss("ESS7e01.sav",to.data.frame=T)
```

As default the data is imported to a list but it is more convenient to work with data.frames. Therefore we have to specify in a further argument, that we want to work with a data.frame.

With the package `foreign`it is also possible to import stata-data:

```{r,eval=F}
ESS7s <- read.dta("ESS7e01.dta")
```

Some Links on import and export of data in R:

- [Quick R on importing data](http://www.statmethods.net/input/importingdata.html)

- [Quick R on exporting data](http://www.statmethods.net/input/exportingdata.html)


## Subsetting

## Merging



## A first example dataset

The first example dataset is a synthetic example. For more information on the generation of this dataset see the r-code [here](https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/rcode/SampEst_GenerateExdata.R).

```{r}
link <- "https://raw.githubusercontent.com/BernStZi/SamplingAndEsimation/master/excercise/data/my.pop.csv"

my.pop <- read.csv(link)
head(my.pop)
```


The dollar sign can also be used to access the columns

```{r}
head(my.pop$gender)
```

With the command `table` we get a frequency table:

```{r}
table(my.pop$gender)
```

With `prop.table` we get the relative frequencies:

```{r}
tabA <- table(my.pop$gender)
prop.table(tabA)
```



## Simple Example on Sampling

Summary of the dataset

```{r}
summary(my.pop)
prop.table(table(my.pop$gender,my.pop$education))
var(my.pop$iq)*(nrow(my.pop)-1)/nrow(my.pop)
```

In the following example two simply random samples are drawn, one with replacement and one without replacement:

```{r}
s.SRS <- sample(1:nrow(my.pop),500,replace=T)
s.SRSWOR <- sample(1:nrow(my.pop),500,replace=F)
```


```{r}
my.samp.SRS <- my.pop[s.SRS,]
my.samp.SRSWOR <- my.pop[s.SRSWOR,]
summary(my.samp.SRS)
```

Making graphics to compare the samples:

```{r}
plot(density(my.pop$iq),main = "My first density plot"
     , xlab = "IQ")
abline(v=mean(my.pop$iq), col = "black")
lines(density(my.samp.SRS$iq),col = "red",lwd=2)
lines(density(my.samp.SRSWOR$iq),col = "blue",lwd=2)
```

```{r,warning=F}
library("sampling")
set.seed(42)
s.SRS1 <- srswr(500,nrow(my.pop))
s.SRSWOR1 <- srswor(500,nrow(my.pop)) 
my.samp.SRS1 <- rbind(my.pop[s.SRS1!=0,]
                      ,my.pop[s.SRS1>1,])
my.samp.SRSWOR1 <- my.pop[s.SRSWOR1==1,]
```

```{r}
par(mfrow=c(1,2))
plot(density(my.pop$iq),main = "My first density plot"
     , xlab = "IQ")
abline(v=mean(my.pop$iq), col = "black")
lines(density(my.samp.SRS$iq),col = "red",lwd=2)
lines(density(my.samp.SRSWOR$iq),col = "blue",lwd=2)
```

```{r}
par(mfrow=c(1,2))
plot(density(my.pop$iq),main = "My second density plot"
     , xlab = "IQ")
abline(v=mean(my.pop$iq), col = "black")
lines(density(my.samp.SRS1$iq),col = "red",lwd=2)
lines(density(my.samp.SRSWOR1$iq),col = "blue",lwd=2)
```

- should yield same results
- routine may differ because of "starting point"

