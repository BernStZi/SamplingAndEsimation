% beamertheme for gesis
% Version 1.0. 10.11.2017 Ulrike Fischer fischer@troubleshooting-tex.de
\mode<presentation>

%fonts:
\RequirePackage{ifluatex,ifxetex,iflang,etoolbox}
\ifboolexpr{bool{luatex} or bool{xetex}}
{
 \RequirePackage{fontspec}
 \setsansfont{Arial}
}
{
 \RequirePackage[T1]{fontenc}
 \RequirePackage{microtype}
 \RequirePackage{tgheros}
}

%

\setbeamerfont{title}{size=\Large,series=\bfseries,parent=structure}


%colors
\usecolortheme{Gesis}


%outer definitions (headline, footline, frametitle)

\setbeamertemplate{navigation symbols}{}
%length for the headline. The 0.0 is top left.
\newlength\gesis@headlineborderheight
\setlength\gesis@headlineborderheight{3mm}
\newlength\gesis@headlineheight
\setlength\gesis@headlineheight{1.27cm}
\newlength\gesis@headlogoypos
\setlength\gesis@headlogoypos{6mm}
\newlength\gesis@headlogoxpos
\setlength\gesis@headlogoxpos{0.6cm}
\newlength\gesis@headlogowidth
\setlength\gesis@headlogowidth{2.3cm}
\newlength\gesis@titlebandheight
\setlength\gesis@titlebandheight{0.19\paperheight}
\newlength\gesis@housewidth
\settowidth\gesis@housewidth{\includegraphics[height=0.38\paperheight]{gesis-house}}

\newcommand\gesis@headband{}%
%\fill[gesisdarkbg](0,0) rectangle (\paperwidth,-\gesis@headlineborderheight);%
%}

\defbeamertemplate{gesisheadband}{shaded}
{%
 \fill[left color=white,right color=gesisdarkbg](0,0) rectangle (\paperwidth,-\gesis@headlineborderheight);%
}

\defbeamertemplate{gesisheadband}{solid}
{%
 \fill[gesisdarkbg](0,0) rectangle (\paperwidth,-\gesis@headlineborderheight);%
}

\setbeamertemplate{gesisheadband}[solid]

\defbeamertemplate*{headline}{gesis}
{%\leavevmode
\begin{tikzpicture}
\fill[white](0,0) rectangle (\paperwidth,-\gesis@headlineheight);
\usebeamertemplate{gesisheadband}
\node[anchor=north west] at (\gesis@headlogoxpos,-\gesis@headlogoypos) {%
 \includegraphics[width=\gesis@headlogowidth]{\IfLanguageName{english}{gesis-logo-en}{gesis-logo-de}}};
\end{tikzpicture}%
}

\defbeamertemplate{headline}{gesis title}
{
 \begin{tikzpicture}
 \fill[white](0,0) rectangle (\paperwidth,-\gesis@headlineheight);
 \usebeamertemplate{gesisheadband}
 \node[anchor=north west] at (\gesis@headlogoxpos,-1.6cm) {%
 \includegraphics[width=2.5\gesis@headlogowidth]{\IfLanguageName{english}{gesis-logo-en}{gesis-logo-de}}};
 %\draw[overlay,red,<->] (2cm,-\gesis@headlineborderheight)--++(0,-1.4cm); %debug
 %\draw[overlay,red,<->] (2cm,-\gesis@headlineheight-1.1cm)--++(0,-1.4cm);%debug
 \end{tikzpicture}%
}


\defbeamertemplate*{footline}{gesis}
{\hskip\gesis@headlogoxpos\begin{beamercolorbox}[ht=2.5ex,dp=4ex,wd=\dimexpr\paperwidth-\gesis@headlogoxpos-\Gm@rmargin]{background canvas}
 \raisebox{-0.43\height}{\includegraphics[width=0.5cm]{gesis-foot-logo}}\hfill\tiny \insertframenumber{} / \inserttotalframenumber
\end{beamercolorbox}\hskip\Gm@rmargin}

\defbeamertemplate{footline}{gesis title}
{\hskip\gesis@headlogoxpos
 \begin{beamercolorbox}[ht=2.5ex,dp=4ex,wd=\dimexpr\paperwidth-\gesis@headlogoxpos-\Gm@rmargin]{background canvas}
 \raisebox{-0.43\height}{\includegraphics[width=1cm]{gesis-foot-logo}}
\end{beamercolorbox}\hskip\Gm@rmargin}


\setbeamertemplate{frametitle}[default][center]
\setbeamerfont{frametitle}{series=\bfseries,size=\LARGE}

% inner themes
\useinnertheme{rectangles}

\setbeamercolor{gesislightbox}{fg=gesisdarkbg,bg=gesislightbg}
\setbeamercolor{gesisdarkbgbox}{fg=white,bg=gesisdarkbg}
%title page
\defbeamertemplate*{title page}{gesis}[1][]
{%
 \vspace{1.9cm}
 \begingroup
 \begin{beamercolorbox}[wd=\paperwidth,ht=\gesis@titlebandheight,dp=0pt,colsep=0pt]{gesislightbox}
  \hspace{\dimexpr\Gm@lmargin+\gesis@housewidth+\Gm@lmargin}%
  \raisebox{\dimexpr0.5\gesis@titlebandheight}[0pt][0pt]
   {%
    \usebeamerfont{title}%
    \raisebox{0.5\depth}
     {\parbox[t]
      {\dimexpr\paperwidth-\Gm@lmargin-\gesis@housewidth-2em}
      {\vspace{0pt}\inserttitle}}}
  \end{beamercolorbox}\nointerlineskip
 \begin{beamercolorbox}[wd=\paperwidth,ht=\gesis@titlebandheight,dp=0pt,colsep=0pt]{gesisdarkbgbox}
  \hspace{\Gm@lmargin}%
  \raisebox{0pt}[0pt][0pt]{\includegraphics[height=2\gesis@titlebandheight]{gesis-house}}%
  \hspace{\Gm@lmargin}%
  \raisebox{\dimexpr0.5\gesis@titlebandheight}[0pt][0pt]
   {%
    \usebeamerfont{subtitle}%
    \raisebox{0.5\depth}
     {\parbox[t]
      {\dimexpr\paperwidth-\Gm@lmargin-\gesis@housewidth-\Gm@lmargin}
      {\vspace{0pt}\insertsubtitle\par\insertauthor\par\insertdate}}}

 \end{beamercolorbox}
  \endgroup
  \vfill
}

% own title command

\newcommand\gesismaketitle{%
 \begingroup
  \setbeamertemplate{headline}[gesis title]
  \setbeamertemplate{footline}[gesis title]
 \maketitle
\endgroup}


\mode
<all>
