---
title: "Exercise 2"
author: "Jan-Philipp Kolb, Stefan Zins and Matthias Sand"
date: "1. Februar 2016"
output: md_document
---

```{r,echo=F}
Ex <- F
library(knitr)
```

## Exercise 2

1 Load the survey package and the api datasets in it.

2 The dataset apistrat is a sample of schools from apipop
stratified by stype. Assuming the selection within the
strata was done by SRS, define a svydesign object that
enables your to make unbiased point and variance
estimates. Estimate the mean of api00.

3 Now you should try different allocations. Using stype
again as a stratification variable calculate the allocation of
a sample of 60 schools from apipop, using equal,
proportional to the number of schools, and optimal with
regard to api99 allocation.

4 Select a StrSRS from apipop for each of your allocations.

5 Estimate again the mean of api00 from your three different
samples.



## The `survey` library



- Load `survey` library and dataset apistrat

## The survey library

```{r,message=F}
library(survey)
```


The dataset apistrat is a sample of schools from apipop
stratified by stype. 

```{r}
data(api)
```

```{r,eval=F}
head(apistrat)
```

```{r,echo=F}
kable(apistrat[1:8,1:5])
```


## Exercise 1 - Part 2

Assuming the selection within the
strata was done by SRS, define a svydesign object that
enables you to make unbiased point and variance
estimates. 

- Estimate the mean of variable `api00`.

```{r}
mean(apistrat$api00)
```

## Exercise 1 - Part 3

Now you should try different allocations. 

Using `stype` as a stratification variable calculate the allocation of a sample of 60 schools from apipop. Use

- equal allocation
- proportional allocation (proportional to nr. of schools)
- optimal allocation (with regard to `api99` allocation)

Select a StrSRS from apipop for each of your allocations.

- Estimate again the mean of api00 from your three different
samples.



## Exercise 2 - Estimation under stratified design

- Download ESS
- Define a survey object

## Exercise 1 - Part 1

Download ESS

- Download the ESS dataset for [Denmark](http://www.europeansocialsurvey.org/file/download?f=ESS5DK.spss.zip&c=DK&y=2010) (Sampling Data and Country File) of the 5th round


## Packages for data import

- Use the package `foreign`

```{r,message=F,warning=F}
library(foreign)
```

```{r,message=F,warning=F}
library(memisc)
```



```{r,echo=F}
## Set working directory
main.path <- "J:/Work/Statistik/Kolb/Workshops/2016/grade_sampling/"

data.path <- paste(main.path,"data/",sep="")

setwd(data.path)
```


## [Import portable spss-files](http://stackoverflow.com/questions/3136293/read-spss-file-into-r)

```{r,eval=Ex}
DK <- as.data.set(spss.portable.file("ESS5DK.por"))
SE <- as.data.set(spss.portable.file("ESS5SE.por"))
```


```{r,eval=Ex}
DK <- as.data.frame(DK)
SE <- as.data.frame(SE)
```

```{r,eval=Ex,echo=F}

```

## Load the ESS dataset and the country file
